%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#191919',
  'primaryTextColor': '#cccccc',
  'primaryBorderColor': '#242424',
  'lineColor': '#cccccc',
  'secondaryColor': '#404040',
  'tertiaryColor': '#4b5563'
}}}%%

flowchart TD
    subgraph Frontend ["ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´ (React + Next.js + TypeScript)"]
        subgraph ReactComponents ["React ì»´í¬ë„ŒíŠ¸"]
            Chat["ğŸ’¬ ChatInterface<br/>AI ì±„íŒ… ì¸í„°í˜ì´ìŠ¤"]
            Policy["ğŸ“„ PolicyManagement<br/>ì•½ê´€ ê´€ë¦¬"]
            Workflow["ğŸ“Š WorkflowMonitoring<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
            Dashboard["ğŸ“ˆ PerformanceDashboard<br/>ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ"]
            Auth["ğŸ” Login<br/>ì‚¬ìš©ì ì¸ì¦"]
        end
        
        APIClient["ğŸ”Œ API Client<br/>services/api.ts<br/>HTTP í†µì‹ "]
        AuthContext["ğŸ‘¤ AuthContext<br/>ì¸ì¦ ìƒíƒœ ê´€ë¦¬"]
    end
    
    subgraph Backend ["âš™ï¸ ë°±ì—”ë“œ ë ˆì´ì–´ (FastAPI + Python)"]
        subgraph APIRouters ["ğŸš€ API ë¼ìš°í„°"]
            AuthRouter["ğŸ”‘ ì¸ì¦ API<br/>/auth/*"]
            PolicyRouter["ğŸ“‹ ì•½ê´€ ê´€ë¦¬ API<br/>/policies/*"]
            SearchRouter["ğŸ” ê²€ìƒ‰ API<br/>/search/*"]
            WorkflowRouter["ğŸ“ˆ ì›Œí¬í”Œë¡œìš° API<br/>/workflow/*"]
            DashboardRouter["ğŸ“Š ëŒ€ì‹œë³´ë“œ API<br/>/dashboard/*"]
        end
        
        subgraph Services ["ğŸ› ï¸ ì„œë¹„ìŠ¤ ë ˆì´ì–´"]
            AuthService["ğŸ” ì¸ì¦ ì„œë¹„ìŠ¤<br/>JWT í† í° ê´€ë¦¬"]
            DBService["ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤<br/>SQLAlchemy ORM"]
            VectorService["ğŸ—‚ï¸ ë²¡í„° ì €ì¥ì†Œ ì„œë¹„ìŠ¤<br/>pgvector ì—°ë™"]
            PerformanceService["ğŸ“Š ì„±ëŠ¥ ìˆ˜ì§‘ ì„œë¹„ìŠ¤<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘"]
            WorkflowLogger["ğŸ“‹ ì›Œí¬í”Œë¡œìš° ë¡œê±°<br/>ì‹¤í–‰ ë¡œê·¸ ê´€ë¦¬"]
        end
    end
    
    subgraph AgentSystem ["ğŸ¤– Multi-Agent ì‹œìŠ¤í…œ (LangGraph)"]
        Supervisor["ğŸ¯ Supervisor Agent<br/>ì›Œí¬í”Œë¡œìš° ì¡°ìœ¨"]
        
        subgraph ProcessingAgents ["ë¬¸ì„œ ì²˜ë¦¬ ì—ì´ì „íŠ¸"]
            PDFAgent["ğŸ“„ PDF Processor<br/>PDF êµ¬ì¡° ë¶„ì„"]
            TextAgent["ğŸ“ Text Processor<br/>í…ìŠ¤íŠ¸ ì¶”ì¶œ/ì •ì œ"]
            TableAgent["ğŸ“Š Table Processor<br/>í‘œ ë°ì´í„° êµ¬ì¡°í™”"]
            ImageAgent["ğŸ–¼ï¸ Image Processor<br/>OCR/ì´ë¯¸ì§€ ë¶„ì„"]
            MarkdownAgent["ğŸ“ Markdown Processor<br/>ë§ˆí¬ë‹¤ìš´ ë³€í™˜"]
        end
        
        subgraph RAGAgents ["RAG ê²€ìƒ‰ ì—ì´ì „íŠ¸"]
            QueryProcessor["ğŸ” Query Processor<br/>ì§ˆì˜ ì „ì²˜ë¦¬"]
            SearchEngine["ğŸ” Advanced Search Engine<br/>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰"]
            ResultService["ğŸ“‹ Result Service<br/>ê²°ê³¼ í›„ì²˜ë¦¬"]
            AnswerService["ğŸ¤– Answer Service<br/>LLM ë‹µë³€ ìƒì„±"]
        end
        
        subgraph EmbeddingAgents ["ì„ë² ë”© ì—ì´ì „íŠ¸"]
            EmbedAgent["ğŸ§  Embedding Agent<br/>ì„ë² ë”© ìƒì„±"]
            VectorAgent["ğŸ—‚ï¸ VectorStore Agent<br/>pgvector ì €ì¥"]
        end
    end
    
    subgraph Database ["ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ (PostgreSQL + pgvector)"]
        subgraph CoreTables ["ğŸ“Š í•µì‹¬ í…Œì´ë¸”"]
            Users["ğŸ‘¥ users<br/>ì‚¬ìš©ì ì •ë³´"]
            Policies["ğŸ“‘ policies<br/>ì•½ê´€ ë©”íƒ€ë°ì´í„°"]
            WorkflowLogs["ğŸ“‹ workflow_logs<br/>ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë¡œê·¸"]
        end
        
        subgraph VectorTables ["ğŸ§  ë²¡í„° í…Œì´ë¸”"]
            Embeddings1["ğŸ§  embeddings_text_embedding_3<br/>3072ì°¨ì› ë²¡í„°"]
            Embeddings2["ğŸ§  embeddings_qwen<br/>4096ì°¨ì› ë²¡í„°"]
        end
        
        VectorDB["ğŸ” pgvector<br/>ë²¡í„° ì¸ë±ìŠ¤ ê²€ìƒ‰<br/>HNSW, IVFFlat"]
    end
    
    subgraph External ["ğŸŒ ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        OpenAI["ğŸ¤– OpenAI API<br/>GPT-4, text-embedding-3"]
        LangFuse["ğŸ“Š LangFuse<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
        MCP["ğŸ”— MCP Protocol<br/>ìë™ Tool í˜¸ì¶œ"]
    end
    
    subgraph Monitoring ["ğŸ“Š ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ"]
        RealTimeDashboard["ğŸ“ˆ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ<br/>Recharts ì‹œê°í™”"]
        MetricsCollector["ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘<br/>ì‘ë‹µì‹œê°„, ì„±ê³µë¥ "]
        AlertSystem["ğŸš¨ ì•Œë¦¼ ì‹œìŠ¤í…œ<br/>ì˜¤ë¥˜ ê°ì§€"]
    end
    
    %% í”„ë¡ íŠ¸ì—”ë“œ ë‚´ë¶€ ì—°ê²°
    Chat --> APIClient
    Policy --> APIClient
    Workflow --> APIClient
    Dashboard --> APIClient
    Auth --> APIClient
    
    APIClient --> AuthRouter
    APIClient --> PolicyRouter
    APIClient --> SearchRouter
    APIClient --> WorkflowRouter
    APIClient --> DashboardRouter
    
    %% ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì—°ê²°
    AuthRouter --> AuthService
    PolicyRouter --> DBService
    DashboardRouter --> PerformanceService
    WorkflowRouter --> WorkflowLogger
    
    %% í•µì‹¬ Multi-Agent ì—°ê²°
    PolicyRouter ==> Supervisor
    SearchRouter ==> QueryProcessor
    
    %% Multi-Agent ë‚´ë¶€ í”Œë¡œìš°
    Supervisor --> PDFAgent
    Supervisor --> TextAgent
    Supervisor --> TableAgent
    Supervisor --> ImageAgent
    Supervisor --> MarkdownAgent
    Supervisor --> EmbedAgent
    Supervisor --> VectorAgent
    
    %% RAG ê²€ìƒ‰ í”Œë¡œìš°
    QueryProcessor --> SearchEngine
    SearchEngine --> ResultService
    ResultService --> AnswerService
    SearchEngine --> VectorDB
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    DBService --> Users
    DBService --> Policies
    AuthService --> Users
    WorkflowLogger --> WorkflowLogs
    
    VectorAgent --> Embeddings1
    VectorAgent --> Embeddings2
    VectorAgent --> VectorDB
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°
    EmbedAgent --> OpenAI
    AnswerService --> OpenAI
    Supervisor --> LangFuse
    Chat --> MCP
    
    %% ëª¨ë‹ˆí„°ë§ ì—°ê²°
    Supervisor -.-> MetricsCollector
    WorkflowLogger -.-> RealTimeDashboard
    PerformanceService -.-> MetricsCollector
    MetricsCollector -.-> AlertSystem
    
    %% ìŠ¤íƒ€ì¼ë§ (ê¸°ì¡´ archi.svg ìŠ¤íƒ€ì¼ê³¼ ë™ì¼)
    classDef frontend fill:#0d47a1,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef backend fill:#1b5e20,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef agent fill:#b71c1c,stroke:#d32f2f,stroke-width:2px,color:#ffffff
    classDef database fill:#e65100,stroke:#ff8f00,stroke-width:2px,color:#ffffff
    classDef external fill:#4a148c,stroke:#6a1b9a,stroke-width:2px,color:#ffffff
    classDef monitoring fill:#263238,stroke:#37474f,stroke-width:2px,color:#ffffff
    
    class Chat,Policy,Workflow,Dashboard,Auth,APIClient,AuthContext frontend
    class AuthRouter,PolicyRouter,SearchRouter,WorkflowRouter,DashboardRouter,AuthService,DBService,VectorService,PerformanceService,WorkflowLogger backend
    class Supervisor,PDFAgent,TextAgent,TableAgent,ImageAgent,MarkdownAgent,EmbedAgent,VectorAgent,QueryProcessor,SearchEngine,ResultService,AnswerService agent
    class Users,Policies,WorkflowLogs,Embeddings1,Embeddings2,VectorDB database
    class OpenAI,LangFuse,MCP external
    class RealTimeDashboard,MetricsCollector,AlertSystem monitoring




