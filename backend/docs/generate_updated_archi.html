<!DOCTYPE html>
<html>
<head>
    <title>ISPL2 Updated Architecture SVG Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'trebuchet ms', verdana, arial, sans-serif;
            margin: 20px;
            background-color: #191919;
            color: #cccccc;
        }
        .container {
            max-width: none;
            width: 100%;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background-color: #191919;
            border-radius: 8px;
            padding: 20px;
        }
        #download-btn {
            margin: 20px;
            padding: 10px 20px;
            background-color: #4fc3f7;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        #instructions {
            margin: 20px;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 8px;
            color: #cccccc;
        }
    </style>
</head>
<body>
    <div id="instructions">
        <h3>ğŸ“‹ SVG ìƒì„± ì•ˆë‚´</h3>
        <p>1. ë‹¤ì´ì–´ê·¸ë¨ì´ ë Œë”ë§ë  ë•Œê¹Œì§€ ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
        <p>2. ê°œë°œì ë„êµ¬(F12)ë¥¼ ì—´ê³  Elements íƒ­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
        <p>3. <code>&lt;svg&gt;</code> ìš”ì†Œë¥¼ ì°¾ì•„ ìš°í´ë¦­ â†’ "Copy element"ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p>
        <p>4. í…ìŠ¤íŠ¸ ì—ë””í„°ì— ë¶™ì—¬ë„£ê¸°í•˜ê³  <code>archi.svg</code> íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="container">
        <div class="mermaid">
%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#191919',
  'primaryTextColor': 'rgba(204, 204, 204, 0.87)',
  'primaryBorderColor': '#242424',
  'lineColor': 'rgba(204, 204, 204, 0.87)',
  'secondaryColor': 'rgba(64, 64, 64, 0.47)',
  'tertiaryColor': '#4b5563',
  'background': '#191919',
  'mainBkg': '#191919',
  'secondaryBkg': '#404040',
  'tertiaryBkg': '#4b5563'
}}}%%

flowchart TD
    %% í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´
    subgraph Frontend ["ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´ (React + Next.js + TypeScript)"]
        subgraph ReactComponents ["React ì»´í¬ë„ŒíŠ¸"]
            Chat["ğŸ’¬ ChatInterface<br/>AI ì±„íŒ… ì¸í„°í˜ì´ìŠ¤"]
            Policy["ğŸ“„ PolicyManagement<br/>ì•½ê´€ ê´€ë¦¬"]
            Workflow["ğŸ“Š WorkflowMonitoring<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
            Dashboard["ğŸ“ˆ PerformanceDashboard<br/>ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ"]
            Auth["ğŸ” Login<br/>ì‚¬ìš©ì ì¸ì¦"]
        end
        
        APIClient["ğŸ”Œ API Client<br/>services/api.ts<br/>HTTP í†µì‹ "]
        AuthContext["ğŸ‘¤ AuthContext<br/>ì¸ì¦ ìƒíƒœ ê´€ë¦¬"]
    end
    
    %% ë°±ì—”ë“œ ë ˆì´ì–´
    subgraph Backend ["âš™ï¸ ë°±ì—”ë“œ ë ˆì´ì–´ (FastAPI + Python)"]
        subgraph APIRouters ["ğŸš€ API ë¼ìš°í„°"]
            AuthRouter["ğŸ”‘ ì¸ì¦ API<br/>/auth/*"]
            PolicyRouter["ğŸ“‹ ì•½ê´€ ê´€ë¦¬ API<br/>/policies/*"]
            SearchRouter["ğŸ” ê²€ìƒ‰ API<br/>/search/*"]
            WorkflowRouter["ğŸ“ˆ ì›Œí¬í”Œë¡œìš° API<br/>/workflow/*"]
            DashboardRouter["ğŸ“Š ëŒ€ì‹œë³´ë“œ API<br/>/dashboard/*"]
        end
        
        subgraph Services ["ğŸ› ï¸ ì„œë¹„ìŠ¤ ë ˆì´ì–´"]
            AuthService["ğŸ” ì¸ì¦ ì„œë¹„ìŠ¤<br/>JWT í† í° ê´€ë¦¬"]
            DBService["ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤<br/>SQLAlchemy ORM"]
            VectorService["ğŸ—‚ï¸ ë²¡í„° ì €ì¥ì†Œ ì„œë¹„ìŠ¤<br/>pgvector ì—°ë™"]
            PerformanceService["ğŸ“Š ì„±ëŠ¥ ìˆ˜ì§‘ ì„œë¹„ìŠ¤<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘"]
            WorkflowLogger["ğŸ“‹ ì›Œí¬í”Œë¡œìš° ë¡œê±°<br/>ì‹¤í–‰ ë¡œê·¸ ê´€ë¦¬"]
        end
    end
    
    %% Multi-Agent ì‹œìŠ¤í…œ
    subgraph AgentSystem ["ğŸ¤– Multi-Agent ì‹œìŠ¤í…œ (LangGraph)"]
        Supervisor["ğŸ¯ Supervisor Agent<br/>ì›Œí¬í”Œë¡œìš° ì¡°ìœ¨"]
        
        subgraph ProcessingAgents ["ë¬¸ì„œ ì²˜ë¦¬ ì—ì´ì „íŠ¸"]
            PDFAgent["ğŸ“„ PDF Processor<br/>PDF êµ¬ì¡° ë¶„ì„"]
            TextAgent["ğŸ“ Text Processor<br/>í…ìŠ¤íŠ¸ ì¶”ì¶œ/ì •ì œ"]
            TableAgent["ğŸ“Š Table Processor<br/>í‘œ ë°ì´í„° êµ¬ì¡°í™”"]
            ImageAgent["ğŸ–¼ï¸ Image Processor<br/>OCR/ì´ë¯¸ì§€ ë¶„ì„"]
            MarkdownAgent["ğŸ“ Markdown Processor<br/>ë§ˆí¬ë‹¤ìš´ ë³€í™˜"]
        end
        
        subgraph RAGAgents ["RAG ê²€ìƒ‰ ì—ì´ì „íŠ¸"]
            QueryProcessor["ğŸ” Query Processor<br/>ì§ˆì˜ ì „ì²˜ë¦¬"]
            SearchEngine["ğŸ” Advanced Search Engine<br/>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰"]
            ResultService["ğŸ“‹ Result Service<br/>ê²°ê³¼ í›„ì²˜ë¦¬"]
            AnswerService["ğŸ¤– Answer Service<br/>LLM ë‹µë³€ ìƒì„±"]
        end
        
        subgraph EmbeddingAgents ["ì„ë² ë”© ì—ì´ì „íŠ¸"]
            EmbedAgent["ğŸ§  Embedding Agent<br/>ì„ë² ë”© ìƒì„±"]
            VectorAgent["ğŸ—‚ï¸ VectorStore Agent<br/>pgvector ì €ì¥"]
        end
    end
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´
    subgraph Database ["ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ (PostgreSQL + pgvector)"]
        subgraph CoreTables ["ğŸ“Š í•µì‹¬ í…Œì´ë¸”"]
            Users["ğŸ‘¥ users<br/>ì‚¬ìš©ì ì •ë³´"]
            Policies["ğŸ“‘ policies<br/>ì•½ê´€ ë©”íƒ€ë°ì´í„°"]
            WorkflowLogs["ğŸ“‹ workflow_logs<br/>ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë¡œê·¸"]
        end
        
        subgraph VectorTables ["ğŸ§  ë²¡í„° í…Œì´ë¸”"]
            Embeddings1["ğŸ§  embeddings_text_embedding_3<br/>3072ì°¨ì› ë²¡í„°"]
            Embeddings2["ğŸ§  embeddings_qwen<br/>4096ì°¨ì› ë²¡í„°"]
        end
        
        VectorDB["ğŸ” pgvector<br/>ë²¡í„° ì¸ë±ìŠ¤ ê²€ìƒ‰<br/>HNSW, IVFFlat"]
    end
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤
    subgraph External ["ğŸŒ ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        OpenAI["ğŸ¤– OpenAI API<br/>GPT-4, text-embedding-3"]
        LangFuse["ğŸ“Š LangFuse<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
        MCP["ğŸ”— MCP Protocol<br/>ìë™ Tool í˜¸ì¶œ"]
    end
    
    %% í”„ë¡ íŠ¸ì—”ë“œ ë‚´ë¶€ ì—°ê²°
    Chat --> APIClient
    Policy --> APIClient
    Workflow --> APIClient
    Dashboard --> APIClient
    Auth --> APIClient
    
    APIClient --> AuthRouter
    APIClient --> PolicyRouter
    APIClient --> SearchRouter
    APIClient --> WorkflowRouter
    APIClient --> DashboardRouter
    
    %% ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì—°ê²°
    AuthRouter --> AuthService
    PolicyRouter --> DBService
    DashboardRouter --> PerformanceService
    WorkflowRouter --> WorkflowLogger
    
    %% í•µì‹¬ Multi-Agent ì—°ê²°
    PolicyRouter ==> Supervisor
    SearchRouter ==> QueryProcessor
    
    %% Multi-Agent ë‚´ë¶€ í”Œë¡œìš°
    Supervisor --> PDFAgent
    Supervisor --> TextAgent
    Supervisor --> TableAgent
    Supervisor --> ImageAgent
    Supervisor --> MarkdownAgent
    Supervisor --> EmbedAgent
    Supervisor --> VectorAgent
    
    %% RAG ê²€ìƒ‰ í”Œë¡œìš°
    QueryProcessor --> SearchEngine
    SearchEngine --> ResultService
    ResultService --> AnswerService
    SearchEngine --> VectorDB
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    DBService --> Users
    DBService --> Policies
    AuthService --> Users
    WorkflowLogger --> WorkflowLogs
    
    VectorAgent --> Embeddings1
    VectorAgent --> Embeddings2
    VectorAgent --> VectorDB
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°
    EmbedAgent --> OpenAI
    AnswerService --> OpenAI
    Supervisor --> LangFuse
    Chat --> MCP
    
    %% ìŠ¤íƒ€ì¼ë§ (ê¸°ì¡´ archi.svgì™€ ë™ì¼í•œ ìƒ‰ìƒ)
    classDef frontend fill:#0d47a1,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef backend fill:#1b5e20,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef agent fill:#b71c1c,stroke:#d32f2f,stroke-width:2px,color:#ffffff
    classDef database fill:#e65100,stroke:#ff8f00,stroke-width:2px,color:#ffffff
    classDef external fill:#4a148c,stroke:#6a1b9a,stroke-width:2px,color:#ffffff
    
    class Chat,Policy,Workflow,Dashboard,Auth,APIClient,AuthContext frontend
    class AuthRouter,PolicyRouter,SearchRouter,WorkflowRouter,DashboardRouter,AuthService,DBService,VectorService,PerformanceService,WorkflowLogger backend
    class Supervisor,PDFAgent,TextAgent,TableAgent,ImageAgent,MarkdownAgent,EmbedAgent,VectorAgent,QueryProcessor,SearchEngine,ResultService,AnswerService agent
    class Users,Policies,WorkflowLogs,Embeddings1,Embeddings2,VectorDB database
    class OpenAI,LangFuse,MCP external
        </div>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
        
        // ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ í›„ ì•ˆë‚´ ë©”ì‹œì§€
        setTimeout(() => {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                console.log('âœ… SVG ë‹¤ì´ì–´ê·¸ë¨ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log('ğŸ“‹ ê°œë°œì ë„êµ¬ì—ì„œ <svg> ìš”ì†Œë¥¼ ë³µì‚¬í•˜ì—¬ archi.svg íŒŒì¼ë¡œ ì €ì¥í•˜ì„¸ìš”.');
                
                // SVGì— ì˜¬ë°”ë¥¸ xmlns ì†ì„± ì¶”ê°€
                svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                svg.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');
            }
        }, 3000);
    </script>
</body>
</html>




