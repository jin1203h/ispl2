
<!DOCTYPE html>
<html>
<head>
    <title>ISPL2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .diagram-container {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #2a2a2a;
        }
        h1, h2 {
            text-align: center;
            color: #4fc3f7;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ï¸ ISPL2 ë³´í—˜ì•½ê´€ AI ì‹œìŠ¤í…œ - í˜„ì¬ êµ¬í˜„ ì•„í‚¤í…ì²˜</h1>
    
    <div class="diagram-container">
        <h2>ğŸ“Š ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h2>
        <div class="mermaid">
%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#1f2937',
  'primaryTextColor': '#ffffff',
  'primaryBorderColor': '#374151',
  'lineColor': '#6b7280',
  'secondaryColor': '#374151',
  'tertiaryColor': '#4b5563'
}}}%%

flowchart TD
    %% 1. í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´ (ë§¨ ìœ„)
    subgraph Frontend ["ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´ (React + Next.js + TypeScript)"]
        direction LR
        Chat["ğŸ’¬ ChatInterface<br/>AI ì±„íŒ… ì¸í„°í˜ì´ìŠ¤"]
        Policy["ğŸ“„ PolicyManagement<br/>ì•½ê´€ ê´€ë¦¬"]
        Workflow["ğŸ“Š WorkflowMonitoring<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
        Dashboard["ğŸ“ˆ PerformanceDashboard<br/>ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ"]
        Auth["ğŸ” Login<br/>ì‚¬ìš©ì ì¸ì¦"]
        APIClient["ğŸ”Œ API Client<br/>services/api.ts<br/>HTTP í†µì‹ "]
        AuthContext["ğŸ‘¤ AuthContext<br/>ì¸ì¦ ìƒíƒœ ê´€ë¦¬"]
    end
    
    %% 2. ë°±ì—”ë“œ API ë ˆì´ì–´ (í”„ë¡ íŠ¸ì—”ë“œ ì•„ë˜)  
    subgraph Backend ["âš™ï¸ ë°±ì—”ë“œ ë ˆì´ì–´ (FastAPI + Python)"]
        direction LR
        AuthRouter["ğŸ”‘ ì¸ì¦ API<br/>/auth/*"]
        PolicyRouter["ğŸ“‹ ì•½ê´€ ê´€ë¦¬ API<br/>/policies/*"]
        SearchRouter["ğŸ” ê²€ìƒ‰ API<br/>/search/*"]
        WorkflowRouter["ğŸ“ˆ ì›Œí¬í”Œë¡œìš° API<br/>/workflow/*"]
        DashboardRouter["ğŸ“Š ëŒ€ì‹œë³´ë“œ API<br/>/dashboard/*"]
        AuthService["ğŸ” ì¸ì¦ ì„œë¹„ìŠ¤<br/>JWT í† í° ê´€ë¦¬"]
        DBService["ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤<br/>SQLAlchemy ORM"]
        VectorService["ğŸ—‚ï¸ ë²¡í„° ì €ì¥ì†Œ ì„œë¹„ìŠ¤<br/>pgvector ì—°ë™"]
        PerformanceService["ğŸ“Š ì„±ëŠ¥ ìˆ˜ì§‘ ì„œë¹„ìŠ¤<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘"]
        WorkflowLogger["ğŸ“‹ ì›Œí¬í”Œë¡œìš° ë¡œê±°<br/>ì‹¤í–‰ ë¡œê·¸ ê´€ë¦¬"]
    end
    
    %% 3. Multi-Agent ì‹œìŠ¤í…œ (ë…ë¦½ì  ë°°ì¹˜)
    subgraph AgentSystem ["ğŸ¤– Multi-Agent ì‹œìŠ¤í…œ (LangGraph)"]
        direction LR
        Supervisor["ğŸ¯ Supervisor Agent<br/>ì›Œí¬í”Œë¡œìš° ì¡°ìœ¨<br/>LangGraph ì‹¤í–‰"]
        PDFAgent["ğŸ“„ PDF Processor<br/>PDF êµ¬ì¡° ë¶„ì„"]
        TextAgent["ğŸ“ Text Processor<br/>í…ìŠ¤íŠ¸ ì¶”ì¶œ/ì •ì œ"]
        TableAgent["ğŸ“Š Table Processor<br/>í‘œ ë°ì´í„° êµ¬ì¡°í™”"]
        ImageAgent["ğŸ–¼ï¸ Image Processor<br/>OCR/ì´ë¯¸ì§€ ë¶„ì„"]
        MarkdownAgent["ğŸ“ Markdown Processor<br/>ë§ˆí¬ë‹¤ìš´ ë³€í™˜"]
        QueryProcessor["ğŸ” Query Processor<br/>ì§ˆì˜ ì „ì²˜ë¦¬"]
        SearchEngine["ğŸ” Advanced Search Engine<br/>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰"]
        ResultService["ğŸ“‹ Result Service<br/>ê²°ê³¼ í›„ì²˜ë¦¬"]
        AnswerService["ğŸ¤– Answer Service<br/>LLM ë‹µë³€ ìƒì„±"]
        EmbedAgent["ğŸ§  Embedding Agent<br/>ì„ë² ë”© ìƒì„±"]
        VectorAgent["ğŸ—‚ï¸ VectorStore Agent<br/>pgvector ì €ì¥"]
    end
    
    %% 4. ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ (Multi-Agent ì•„ë˜)
    subgraph Database ["ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ (PostgreSQL + pgvector)"]
        direction LR
        Users["ğŸ‘¥ users<br/>ì‚¬ìš©ì ì •ë³´"]
        Policies["ğŸ“‘ policies<br/>ì•½ê´€ ë©”íƒ€ë°ì´í„°"]
        WorkflowLogs["ğŸ“‹ workflow_logs<br/>ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë¡œê·¸"]
        Embeddings1["ğŸ§  embeddings_text_embedding_3<br/>3072ì°¨ì› ë²¡í„°"]
        Embeddings2["ğŸ§  embeddings_qwen<br/>4096ì°¨ì› ë²¡í„°"]
        VectorDB["ğŸ” pgvector<br/>ë²¡í„° ì¸ë±ìŠ¤ & ê²€ìƒ‰<br/>HNSW, IVFFlat"]
    end
    
    %% 5. ëª¨ë‹ˆí„°ë§ ë ˆì´ì–´ (ê°€ì¥ ì•„ë˜)
    subgraph Monitoring ["ğŸ“Š ëª¨ë‹ˆí„°ë§ & ì„±ëŠ¥ ì¶”ì "]
        direction LR
        RealTimeDashboard["ğŸ“ˆ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ<br/>Recharts ì‹œê°í™”"]
        MetricsCollector["ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘<br/>ì‘ë‹µì‹œê°„, ì„±ê³µë¥ "]
        AlertSystem["ğŸš¨ ì•Œë¦¼ ì‹œìŠ¤í…œ<br/>ì˜¤ë¥˜ ê°ì§€"]
    end
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ (ì¸¡ë©´ ë°°ì¹˜)
    subgraph External ["ğŸŒ ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        direction TB
        OpenAI["ğŸ¤– OpenAI API<br/>GPT-4, text-embedding-3"]
        LangFuse["ğŸ“Š LangFuse<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
        MCP["ğŸ”— MCP Protocol<br/>ìë™ Tool í˜¸ì¶œ"]
    end
    
    %% ë ˆì´ì–´ ê°„ ì£¼ìš” ì—°ê²° (ì„¸ë¡œ í”Œë¡œìš°)
    Frontend --> Backend
    Backend --> AgentSystem  
    AgentSystem --> Database
    Database --> Monitoring
    
    %% í”„ë¡ íŠ¸ì—”ë“œ ë‚´ë¶€ ì—°ê²°
    Chat --> APIClient
    Policy --> APIClient
    Workflow --> APIClient
    Dashboard --> APIClient
    Auth --> APIClient
    
    %% API ë¼ìš°í„° ì—°ê²°
    APIClient --> AuthRouter
    APIClient --> PolicyRouter
    APIClient --> SearchRouter
    APIClient --> WorkflowRouter
    APIClient --> DashboardRouter
    
    %% ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì—°ê²°
    AuthRouter --> AuthService
    PolicyRouter --> DBService
    DashboardRouter --> PerformanceService
    WorkflowRouter --> WorkflowLogger
    
    %% í•µì‹¬ Multi-Agent ì—°ê²°
    PolicyRouter ==> Supervisor
    SearchRouter ==> QueryProcessor
    
    %% Multi-Agent ë‚´ë¶€ í”Œë¡œìš°
    Supervisor --> PDFAgent
    Supervisor --> TextAgent
    Supervisor --> TableAgent
    Supervisor --> ImageAgent
    Supervisor --> MarkdownAgent
    Supervisor --> EmbedAgent
    Supervisor --> VectorAgent
    
    %% RAG ê²€ìƒ‰ í”Œë¡œìš°
    QueryProcessor --> SearchEngine
    SearchEngine --> ResultService
    ResultService --> AnswerService
    SearchEngine --> VectorDB
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    DBService --> Users
    DBService --> Policies
    AuthService --> Users
    WorkflowLogger --> WorkflowLogs
    
    VectorAgent --> Embeddings1
    VectorAgent --> Embeddings2
    VectorAgent --> VectorDB
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°
    EmbedAgent --> OpenAI
    AnswerService --> OpenAI
    Supervisor --> LangFuse
    Chat --> MCP
    
    %% ëª¨ë‹ˆí„°ë§ ì—°ê²°
    Supervisor -.-> MetricsCollector
    WorkflowLogger -.-> RealTimeDashboard
    PerformanceService -.-> MetricsCollector
    MetricsCollector -.-> AlertSystem
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef frontend fill:#2196F3,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef backend fill:#4CAF50,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef agent fill:#FF5722,stroke:#d32f2f,stroke-width:2px,color:#ffffff
    classDef database fill:#9C27B0,stroke:#7b1fa2,stroke-width:2px,color:#ffffff
    classDef external fill:#FF9800,stroke:#f57c00,stroke-width:2px,color:#ffffff
    classDef monitoring fill:#607D8B,stroke:#455a64,stroke-width:2px,color:#ffffff
    
    class Chat,Policy,Workflow,Dashboard,Auth,APIClient,AuthContext frontend
    class AuthRouter,PolicyRouter,SearchRouter,WorkflowRouter,DashboardRouter,AuthService,DBService,VectorService,PerformanceService,WorkflowLogger backend
    class Supervisor,PDFAgent,TextAgent,TableAgent,ImageAgent,MarkdownAgent,EmbedAgent,VectorAgent,QueryProcessor,SearchEngine,ResultService,AnswerService agent
    class Users,Policies,WorkflowLogs,Embeddings1,Embeddings2,VectorDB database
    class OpenAI,LangFuse,MCP external
    class RealTimeDashboard,MetricsCollector,AlertSystem monitoring
        </div>
    </div>
    
    <div class="diagram-container">
        <h2>ğŸ”„ ë°ì´í„° í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨</h2>
        <div class="mermaid">
%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#1f2937',
  'primaryTextColor': '#ffffff',
  'primaryBorderColor': '#374151',
  'lineColor': '#6b7280'
}}}%%

flowchart TD
    %% ì‚¬ìš©ì ìš”ì²­ í”Œë¡œìš°
    User["ğŸ‘¤ ì‚¬ìš©ì<br/>ì›¹ ë¸Œë¼ìš°ì €"]
    
    subgraph ProcessingFlow ["ğŸ“„ ë¬¸ì„œ ì²˜ë¦¬ í”Œë¡œìš°"]
        Upload["ğŸ“¤ PDF ì—…ë¡œë“œ"]
        SupervisorStart["ğŸ¯ Supervisor Agent<br/>ì›Œí¬í”Œë¡œìš° ì‹œì‘"]
        
        subgraph ParallelProcessing ["ğŸ”„ ë³‘ë ¬ ì²˜ë¦¬"]
            PDFProcess["ğŸ“„ PDF ë¶„ì„<br/>êµ¬ì¡° íŒŒì•…"]
            TextExtract["ğŸ“ í…ìŠ¤íŠ¸ ì¶”ì¶œ<br/>ë‚´ìš© ì •ì œ"]
            TableExtract["ğŸ“Š í‘œ ì¶”ì¶œ<br/>ë°ì´í„° êµ¬ì¡°í™”"]
            ImageOCR["ğŸ–¼ï¸ ì´ë¯¸ì§€ OCR<br/>í…ìŠ¤íŠ¸ ì¸ì‹"]
        end
        
        MarkdownConv["ğŸ“ ë§ˆí¬ë‹¤ìš´ ë³€í™˜<br/>í†µí•© ë¬¸ì„œ ìƒì„±"]
        EmbeddingGen["ğŸ§  ì„ë² ë”© ìƒì„±<br/>ë²¡í„°í™”"]
        VectorStore["ğŸ—‚ï¸ ë²¡í„° ì €ì¥<br/>pgvector DB"]
        ProcessComplete["âœ… ì²˜ë¦¬ ì™„ë£Œ<br/>ê²€ìƒ‰ ê°€ëŠ¥"]
    end
    
    subgraph QueryFlow ["ğŸ’¬ ì§ˆì˜ ì‘ë‹µ í”Œë¡œìš°"]
        UserQuery["ğŸ’­ ì‚¬ìš©ì ì§ˆì˜<br/>ìì—°ì–´ ì…ë ¥"]
        RAGSearch["ğŸ” RAG ê²€ìƒ‰<br/>ìœ ì‚¬ë„ ê²€ìƒ‰"]
        ContextRetrieval["ğŸ“‹ ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰<br/>ê´€ë ¨ ì²­í¬ ì¶”ì¶œ"]
        GPTResponse["ğŸ¤– GPT-4 ì‘ë‹µ<br/>ë‹µë³€ ìƒì„±"]
        UserAnswer["ğŸ“ êµ¬ì¡°í™”ëœ ë‹µë³€<br/>ì‚¬ìš©ìì—ê²Œ ì „ë‹¬"]
    end
    
    subgraph MonitoringFlow ["ğŸ“Š ëª¨ë‹ˆí„°ë§ í”Œë¡œìš°"]
        AgentExecution["ğŸ¯ ì—ì´ì „íŠ¸ ì‹¤í–‰"]
        LogCapture["ğŸ“‹ ë¡œê·¸ ìˆ˜ì§‘<br/>workflow_logs"]
        MetricsCollection["ğŸ“Š ì„±ëŠ¥ ìˆ˜ì§‘<br/>ì‘ë‹µì‹œê°„, ìƒíƒœ"]
        DashboardUpdate["ğŸ“ˆ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸<br/>ì‹¤ì‹œê°„ ì‹œê°í™”"]
        LangFuseSync["ğŸ“Š LangFuse ë™ê¸°í™”<br/>ì™¸ë¶€ ëª¨ë‹ˆí„°ë§"]
    end
    
    %% í”Œë¡œìš° ì—°ê²°
    User --> Upload
    Upload --> SupervisorStart
    SupervisorStart --> PDFProcess
    SupervisorStart --> TextExtract
    SupervisorStart --> TableExtract
    SupervisorStart --> ImageOCR
    
    PDFProcess --> MarkdownConv
    TextExtract --> MarkdownConv
    TableExtract --> MarkdownConv
    ImageOCR --> MarkdownConv
    
    MarkdownConv --> EmbeddingGen
    EmbeddingGen --> VectorStore
    VectorStore --> ProcessComplete
    
    %% ì§ˆì˜ í”Œë¡œìš°
    User --> UserQuery
    UserQuery --> RAGSearch
    RAGSearch --> ContextRetrieval
    ContextRetrieval --> GPTResponse
    GPTResponse --> UserAnswer
    UserAnswer --> User
    
    %% ëª¨ë‹ˆí„°ë§ í”Œë¡œìš°
    SupervisorStart --> AgentExecution
    AgentExecution --> LogCapture
    AgentExecution --> MetricsCollection
    LogCapture --> DashboardUpdate
    MetricsCollection --> DashboardUpdate
    AgentExecution --> LangFuseSync
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef user fill:#2196F3,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef processing fill:#FF5722,stroke:#d32f2f,stroke-width:2px,color:#ffffff
    classDef query fill:#4CAF50,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef monitoring fill:#607D8B,stroke:#455a64,stroke-width:2px,color:#ffffff
    classDef storage fill:#9C27B0,stroke:#7b1fa2,stroke-width:2px,color:#ffffff
    
    class User,UserQuery,UserAnswer user
    class Upload,SupervisorStart,PDFProcess,TextExtract,TableExtract,ImageOCR,MarkdownConv,EmbeddingGen,ProcessComplete processing
    class RAGSearch,ContextRetrieval,GPTResponse query
    class AgentExecution,LogCapture,MetricsCollection,DashboardUpdate,LangFuseSync monitoring
    class VectorStore storage
        </div>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>
