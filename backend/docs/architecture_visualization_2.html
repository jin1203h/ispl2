<!DOCTYPE html>
<html>
<head>
    <title>ISPL2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (ìˆ˜ì •ëœ ì—°ê²° ê´€ê³„)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .diagram-container {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #2a2a2a;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        h1, h2 {
            text-align: center;
            color: #4fc3f7;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            background-color: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
        }
        .correction-note {
            background-color: #2d4a22;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .correction-note h3 {
            color: #81C784;
            margin-top: 0;
        }
        .correction-note ul {
            color: #C8E6C9;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ï¸ ISPL2 ë³´í—˜ì•½ê´€ AI ì‹œìŠ¤í…œ - ìˆ˜ì •ëœ ì•„í‚¤í…ì²˜</h1>
    
    <div class="correction-note">
        <h3>ğŸ”´ ìˆ˜ì •ëœ ì£¼ìš” ì—°ê²° ê´€ê³„</h3>
        <ul>
            <li><strong>âœ… ì•½ê´€ API â†’ Multi-Agent:</strong> PDF ì—…ë¡œë“œ ì‹œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ SupervisorAgent ì‹¤í–‰</li>
            <li><strong>âœ… ê²€ìƒ‰ API â†’ Multi-Agent:</strong> RAG ê²€ìƒ‰ì—ì„œ EmbeddingAgent, QueryProcessor ë“± í™œìš©</li>
            <li><strong>âœ… ì›Œí¬í”Œë¡œìš° API â†’ ë°ì´í„°ë² ì´ìŠ¤:</strong> workflow_logs í…Œì´ë¸”ì—ì„œ ì‹¤í–‰ ë¡œê·¸ ì¡°íšŒ</li>
        </ul>
    </div>
    
    <div class="diagram-container">
        <h2>ğŸ“Š ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (í˜„ì¬ êµ¬í˜„ ê¸°ì¤€)</h2>
        <div class="mermaid">
%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#1f2937',
  'primaryTextColor': '#ffffff',
  'primaryBorderColor': '#374151',
  'lineColor': '#6b7280',
  'secondaryColor': '#374151',
  'tertiaryColor': '#4b5563'
}}}%%

flowchart TB
    %% í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´
    subgraph Frontend ["ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ ë ˆì´ì–´ (React + Next.js + TypeScript)"]
        Chat["ğŸ’¬ ChatInterface<br/>AI ì±„íŒ… ì¸í„°í˜ì´ìŠ¤"]
        Policy["ğŸ“„ PolicyManagement<br/>ì•½ê´€ ê´€ë¦¬"]
        Workflow["ğŸ“Š WorkflowMonitoring<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
        Dashboard["ğŸ“ˆ PerformanceDashboard<br/>ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ"]
        APIClient["ğŸ”Œ API Client<br/>services/api.ts"]
        AuthContext["ğŸ‘¤ AuthContext<br/>ì¸ì¦ ìƒíƒœ ê´€ë¦¬"]
    end
    
    %% ë°±ì—”ë“œ API ë ˆì´ì–´
    subgraph Backend ["âš™ï¸ ë°±ì—”ë“œ ë ˆì´ì–´ (FastAPI + Python)"]
        AuthRouter["ğŸ”‘ ì¸ì¦ API<br/>/auth/*"]
        PolicyRouter["ğŸ“‹ ì•½ê´€ ê´€ë¦¬ API<br/>/policies/*"]
        SearchRouter["ğŸ” ê²€ìƒ‰ API<br/>/search/*"]
        WorkflowRouter["ğŸ“ˆ ì›Œí¬í”Œë¡œìš° API<br/>/workflow/*"]
        DashboardRouter["ğŸ“Š ëŒ€ì‹œë³´ë“œ API<br/>/dashboard/*"]
        
        AuthService["ğŸ” ì¸ì¦ ì„œë¹„ìŠ¤<br/>JWT í† í° ê´€ë¦¬"]
        DBService["ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤<br/>SQLAlchemy ORM"]
        WorkflowLogger["ğŸ“‹ ì›Œí¬í”Œë¡œìš° ë¡œê±°<br/>ì‹¤í–‰ ë¡œê·¸ ê´€ë¦¬"]
        PerformanceService["ğŸ“Š ì„±ëŠ¥ ìˆ˜ì§‘ ì„œë¹„ìŠ¤<br/>ë©”íŠ¸ë¦­ ìˆ˜ì§‘"]
    end
    
    %% Multi-Agent ì‹œìŠ¤í…œ
    subgraph AgentSystem ["ğŸ¤– Multi-Agent ì‹œìŠ¤í…œ (LangGraph)"]
        Supervisor["ğŸ¯ Supervisor Agent<br/>ì›Œí¬í”Œë¡œìš° ì¡°ìœ¨"]
        
        PDFAgent["ğŸ“„ PDF Processor<br/>PDF êµ¬ì¡° ë¶„ì„"]
        TextAgent["ğŸ“ Text Processor<br/>í…ìŠ¤íŠ¸ ì¶”ì¶œ/ì •ì œ"]
        TableAgent["ğŸ“Š Table Processor<br/>í‘œ ë°ì´í„° êµ¬ì¡°í™”"]
        ImageAgent["ğŸ–¼ï¸ Image Processor<br/>OCR/ì´ë¯¸ì§€ ë¶„ì„"]
        MarkdownAgent["ğŸ“ Markdown Processor<br/>ë§ˆí¬ë‹¤ìš´ ë³€í™˜"]
        EmbedAgent["ğŸ§  Embedding Agent<br/>ì„ë² ë”© ìƒì„±"]
        VectorAgent["ğŸ—‚ï¸ VectorStore Agent<br/>pgvector ì €ì¥"]
        
        %% RAG ê²€ìƒ‰ ì „ìš© ì—ì´ì „íŠ¸ë“¤
        QueryProcessor["ğŸ” Query Processor<br/>ì§ˆì˜ ì „ì²˜ë¦¬"]
        SearchEngine["ğŸ” Advanced Search Engine<br/>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰"]
        ResultService["ğŸ“‹ Result Service<br/>ê²°ê³¼ í›„ì²˜ë¦¬"]
        AnswerService["ğŸ¤– Answer Service<br/>LLM ë‹µë³€ ìƒì„±"]
    end
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´
    subgraph Database ["ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ (PostgreSQL + pgvector)"]
        Users["ğŸ‘¥ users<br/>ì‚¬ìš©ì ì •ë³´"]
        Policies["ğŸ“‘ policies<br/>ì•½ê´€ ë©”íƒ€ë°ì´í„°"]
        WorkflowLogs["ğŸ“‹ workflow_logs<br/>ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë¡œê·¸"]
        Embeddings1["ğŸ§  embeddings_text_embedding_3<br/>3072ì°¨ì› ë²¡í„°"]
        Embeddings2["ğŸ§  embeddings_qwen<br/>4096ì°¨ì› ë²¡í„°"]
        VectorDB["ğŸ” pgvector<br/>ë²¡í„° ì¸ë±ìŠ¤ ê²€ìƒ‰"]
    end
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤
    subgraph External ["ğŸŒ ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        OpenAI["ğŸ¤– OpenAI API<br/>GPT-4, text-embedding-3"]
        LangFuse["ğŸ“Š LangFuse<br/>ì›Œí¬í”Œë¡œìš° ëª¨ë‹ˆí„°ë§"]
        MCP["ğŸ”— MCP Protocol<br/>ìë™ Tool í˜¸ì¶œ"]
    end
    
    %% ëª¨ë‹ˆí„°ë§ & ì„±ëŠ¥
    subgraph Monitoring ["ğŸ“Š ëª¨ë‹ˆí„°ë§ ì„±ëŠ¥ ì¶”ì "]
        RealTimeDashboard["ğŸ“ˆ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ<br/>Recharts ì‹œê°í™”"]
        MetricsCollector["ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘<br/>ì‘ë‹µì‹œê°„, ì„±ê³µë¥ "]
        AlertSystem["ğŸš¨ ì•Œë¦¼ ì‹œìŠ¤í…œ<br/>ì˜¤ë¥˜ ê°ì§€"]
    end
    
    %% í”„ë¡ íŠ¸ì—”ë“œ ì—°ê²°
    Chat --> APIClient
    Policy --> APIClient
    Workflow --> APIClient
    Dashboard --> APIClient
    
    APIClient --> AuthRouter
    APIClient --> PolicyRouter
    APIClient --> SearchRouter
    APIClient --> WorkflowRouter
    APIClient --> DashboardRouter
    
    %% ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì—°ê²°
    AuthRouter --> AuthService
    DashboardRouter --> PerformanceService
    
    %% ğŸ”´ ìˆ˜ì •ëœ í•µì‹¬ ì—°ê²° ê´€ê³„
    %% 1. ì•½ê´€ API â†’ Multi-Agent (PDF ì—…ë¡œë“œ ì‹œ ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬)
    PolicyRouter ==> Supervisor
    PolicyRouter --> DBService
    
    %% 2. ê²€ìƒ‰ API â†’ Multi-Agent (RAG ê²€ìƒ‰)
    SearchRouter ==> QueryProcessor
    QueryProcessor --> SearchEngine
    SearchEngine --> ResultService
    ResultService --> AnswerService
    
    %% 3. ì›Œí¬í”Œë¡œìš° API â†’ ë°ì´í„°ë² ì´ìŠ¤ (ë¡œê·¸ ì¡°íšŒ)
    WorkflowRouter --> WorkflowLogger
    WorkflowLogger --> WorkflowLogs
    
    %% Multi-Agent ë‚´ë¶€ í”Œë¡œìš°
    Supervisor --> PDFAgent
    Supervisor --> TextAgent
    Supervisor --> TableAgent
    Supervisor --> ImageAgent
    Supervisor --> MarkdownAgent
    Supervisor --> EmbedAgent
    Supervisor --> VectorAgent
    
    %% ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    DBService --> Users
    DBService --> Policies
    AuthService --> Users
    
    VectorAgent --> Embeddings1
    VectorAgent --> Embeddings2
    VectorAgent --> VectorDB
    SearchEngine --> VectorDB
    
    %% ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°
    EmbedAgent --> OpenAI
    AnswerService --> OpenAI
    Supervisor --> LangFuse
    Chat --> MCP
    
    %% ëª¨ë‹ˆí„°ë§ ì—°ê²°
    Supervisor -.-> MetricsCollector
    WorkflowLogger -.-> RealTimeDashboard
    PerformanceService -.-> MetricsCollector
    MetricsCollector -.-> AlertSystem
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef frontend fill:#2196F3,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef backend fill:#4CAF50,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef agent fill:#FF5722,stroke:#d32f2f,stroke-width:2px,color:#ffffff
    classDef database fill:#9C27B0,stroke:#7b1fa2,stroke-width:2px,color:#ffffff
    classDef external fill:#FF9800,stroke:#f57c00,stroke-width:2px,color:#ffffff
    classDef monitoring fill:#607D8B,stroke:#455a64,stroke-width:2px,color:#ffffff
    
    class Chat,Policy,Workflow,Dashboard,APIClient,AuthContext frontend
    class AuthRouter,PolicyRouter,SearchRouter,WorkflowRouter,DashboardRouter,AuthService,DBService,WorkflowLogger,PerformanceService backend
    class Supervisor,PDFAgent,TextAgent,TableAgent,ImageAgent,MarkdownAgent,EmbedAgent,VectorAgent,QueryProcessor,SearchEngine,ResultService,AnswerService agent
    class Users,Policies,WorkflowLogs,Embeddings1,Embeddings2,VectorDB database
    class OpenAI,LangFuse,MCP external
    class RealTimeDashboard,MetricsCollector,AlertSystem monitoring
        </div>
    </div>
    
    <div class="diagram-container">
        <h2>ğŸ”„ ì‹¤ì œ ë°ì´í„° í”Œë¡œìš°</h2>
        <div class="mermaid">
%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#1f2937',
  'primaryTextColor': '#ffffff',
  'primaryBorderColor': '#374151',
  'lineColor': '#6b7280'
}}}%%

flowchart LR
    %% ë¬¸ì„œ ì—…ë¡œë“œ í”Œë¡œìš°
    subgraph UploadFlow ["ğŸ“¤ ë¬¸ì„œ ì—…ë¡œë“œ í”Œë¡œìš°"]
        U1["ì‚¬ìš©ì"] --> U2["ì•½ê´€ API"]
        U2 --> U3["DB ì €ì¥"]
        U2 --> U4["ë°±ê·¸ë¼ìš´ë“œ<br/>Multi-Agent"]
        U4 --> U5["ë²¡í„° ì €ì¥"]
    end
    
    %% ê²€ìƒ‰ í”Œë¡œìš°
    subgraph SearchFlow ["ğŸ” ê²€ìƒ‰ í”Œë¡œìš°"]
        S1["ì‚¬ìš©ì ì§ˆì˜"] --> S2["ê²€ìƒ‰ API"]
        S2 --> S3["Multi-Agent<br/>RAG ì²˜ë¦¬"]
        S3 --> S4["AI ë‹µë³€"]
    end
    
    %% ëª¨ë‹ˆí„°ë§ í”Œë¡œìš°
    subgraph MonitorFlow ["ğŸ“Š ëª¨ë‹ˆí„°ë§ í”Œë¡œìš°"]
        M1["ì—ì´ì „íŠ¸ ì‹¤í–‰"] --> M2["WorkflowLogger"]
        M2 --> M3["workflow_logs"]
        M3 --> M4["ëŒ€ì‹œë³´ë“œ"]
    end
    
    classDef upload fill:#4CAF50,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef search fill:#2196F3,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef monitor fill:#607D8B,stroke:#455a64,stroke-width:2px,color:#ffffff
    
    class U1,U2,U3,U4,U5 upload
    class S1,S2,S3,S4 search
    class M1,M2,M3,M4 monitor
        </div>
    </div>
    
    <div class="correction-note">
        <h3>ğŸ“‹ êµ¬í˜„ ê²€ì¦ ê²°ê³¼</h3>
        <ul>
            <li><strong>ì•½ê´€ ì—…ë¡œë“œ:</strong> <code>policies.py</code> 298-304ì¤„ì—ì„œ <code>BackgroundTasks.add_task(process_policy_document)</code> í™•ì¸</li>
            <li><strong>RAG ê²€ìƒ‰:</strong> <code>search.py</code> 66-126ì¤„ì—ì„œ Multi-Agent RAG íŒŒì´í”„ë¼ì¸ í™•ì¸</li>
            <li><strong>ì›Œí¬í”Œë¡œìš° ë¡œê·¸:</strong> <code>workflow.py</code>ì—ì„œ <code>WorkflowLoggerService</code> ì‚¬ìš© í™•ì¸</li>
        </ul>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>