%%{init: {'theme':'dark', 'themeVariables': {
  'primaryColor': '#1f2937',
  'primaryTextColor': '#ffffff',
  'primaryBorderColor': '#374151',
  'lineColor': '#6b7280'
}}}%%

flowchart TD
    %% ì‚¬ìš©ì ìš”ì²­ í”Œë¡œìš°
    User["ğŸ‘¤ ì‚¬ìš©ì<br/>ì›¹ ë¸Œë¼ìš°ì €"]
    
    subgraph ProcessingFlow ["ğŸ“„ ë¬¸ì„œ ì²˜ë¦¬ í”Œë¡œìš°"]
        Upload["ğŸ“¤ PDF ì—…ë¡œë“œ"]
        SupervisorStart["ğŸ¯ Supervisor Agent<br/>ì›Œí¬í”Œë¡œìš° ì‹œì‘"]
        
        subgraph ParallelProcessing ["ğŸ”„ ë³‘ë ¬ ì²˜ë¦¬"]
            PDFProcess["ğŸ“„ PDF ë¶„ì„<br/>êµ¬ì¡° íŒŒì•…"]
            TextExtract["ğŸ“ í…ìŠ¤íŠ¸ ì¶”ì¶œ<br/>ë‚´ìš© ì •ì œ"]
            TableExtract["ğŸ“Š í‘œ ì¶”ì¶œ<br/>ë°ì´í„° êµ¬ì¡°í™”"]
            ImageOCR["ğŸ–¼ï¸ ì´ë¯¸ì§€ OCR<br/>í…ìŠ¤íŠ¸ ì¸ì‹"]
        end
        
        MarkdownConv["ğŸ“ ë§ˆí¬ë‹¤ìš´ ë³€í™˜<br/>í†µí•© ë¬¸ì„œ ìƒì„±"]
        EmbeddingGen["ğŸ§  ì„ë² ë”© ìƒì„±<br/>ë²¡í„°í™”"]
        VectorStore["ğŸ—‚ï¸ ë²¡í„° ì €ì¥<br/>pgvector DB"]
        ProcessComplete["âœ… ì²˜ë¦¬ ì™„ë£Œ<br/>ê²€ìƒ‰ ê°€ëŠ¥"]
    end
    
    subgraph QueryFlow ["ğŸ’¬ ì§ˆì˜ ì‘ë‹µ í”Œë¡œìš°"]
        UserQuery["ğŸ’­ ì‚¬ìš©ì ì§ˆì˜<br/>ìì—°ì–´ ì…ë ¥"]
        RAGSearch["ğŸ” RAG ê²€ìƒ‰<br/>ìœ ì‚¬ë„ ê²€ìƒ‰"]
        ContextRetrieval["ğŸ“‹ ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰<br/>ê´€ë ¨ ì²­í¬ ì¶”ì¶œ"]
        GPTResponse["ğŸ¤– GPT-4 ì‘ë‹µ<br/>ë‹µë³€ ìƒì„±"]
        UserAnswer["ğŸ“ êµ¬ì¡°í™”ëœ ë‹µë³€<br/>ì‚¬ìš©ìì—ê²Œ ì „ë‹¬"]
    end
    
    subgraph MonitoringFlow ["ğŸ“Š ëª¨ë‹ˆí„°ë§ í”Œë¡œìš°"]
        AgentExecution["ğŸ¯ ì—ì´ì „íŠ¸ ì‹¤í–‰"]
        LogCapture["ğŸ“‹ ë¡œê·¸ ìˆ˜ì§‘<br/>workflow_logs"]
        MetricsCollection["ğŸ“Š ì„±ëŠ¥ ìˆ˜ì§‘<br/>ì‘ë‹µì‹œê°„, ìƒíƒœ"]
        DashboardUpdate["ğŸ“ˆ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸<br/>ì‹¤ì‹œê°„ ì‹œê°í™”"]
        LangFuseSync["ğŸ“Š LangFuse ë™ê¸°í™”<br/>ì™¸ë¶€ ëª¨ë‹ˆí„°ë§"]
    end
    
    %% í”Œë¡œìš° ì—°ê²°
    User --> Upload
    Upload --> SupervisorStart
    SupervisorStart --> PDFProcess
    SupervisorStart --> TextExtract
    SupervisorStart --> TableExtract
    SupervisorStart --> ImageOCR
    
    PDFProcess --> MarkdownConv
    TextExtract --> MarkdownConv
    TableExtract --> MarkdownConv
    ImageOCR --> MarkdownConv
    
    MarkdownConv --> EmbeddingGen
    EmbeddingGen --> VectorStore
    VectorStore --> ProcessComplete
    
    %% ì§ˆì˜ í”Œë¡œìš°
    User --> UserQuery
    UserQuery --> RAGSearch
    RAGSearch --> ContextRetrieval
    ContextRetrieval --> GPTResponse
    GPTResponse --> UserAnswer
    UserAnswer --> User
    
    %% ëª¨ë‹ˆí„°ë§ í”Œë¡œìš°
    SupervisorStart --> AgentExecution
    AgentExecution --> LogCapture
    AgentExecution --> MetricsCollection
    LogCapture --> DashboardUpdate
    MetricsCollection --> DashboardUpdate
    AgentExecution --> LangFuseSync
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef user fill:#2196F3,stroke:#01579b,stroke-width:2px,color:#ffffff
    classDef processing fill:#FF5722,stroke:#d32f2f,stroke-width:2px,color:#ffffff
    classDef query fill:#4CAF50,stroke:#2e7d32,stroke-width:2px,color:#ffffff
    classDef monitoring fill:#607D8B,stroke:#455a64,stroke-width:2px,color:#ffffff
    classDef storage fill:#9C27B0,stroke:#7b1fa2,stroke-width:2px,color:#ffffff
    
    class User,UserQuery,UserAnswer user
    class Upload,SupervisorStart,PDFProcess,TextExtract,TableExtract,ImageOCR,MarkdownConv,EmbeddingGen,ProcessComplete processing
    class RAGSearch,ContextRetrieval,GPTResponse query
    class AgentExecution,LogCapture,MetricsCollection,DashboardUpdate,LangFuseSync monitoring
    class VectorStore storage