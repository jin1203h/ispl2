# ISPL2 보험약관 AI 시스템 - 아키텍처 개요

## 🏗️ **시스템 아키텍처**

### **개요**
ISPL2는 보험약관 처리를 위한 포괄적인 Multi-Agent AI 시스템으로, PDF 문서 분석, RAG 기반 검색, 실시간 모니터링 기능을 제공합니다.

---

## 📊 **상위 레벨 아키텍처**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         ISPL2 시스템 아키텍처                               │
├─────────────────┬─────────────────┬─────────────────┬─────────────────────┤
│   프론트엔드     │    백엔드        │   AI 에이전트    │    데이터베이스      │
│  (React/Next)   │   (FastAPI)     │  (LangGraph)    │ (PostgreSQL+Vector) │
│                 │                 │                 │                     │
│ • 채팅 UI       │ • REST APIs     │ • PDF 분석      │ • 약관 메타데이터    │
│ • 약관 관리     │ • 인증 시스템   │ • 텍스트 추출   │ • 벡터 임베딩       │
│ • 모니터링      │ • 파일 업로드   │ • 표 처리       │ • 사용자 인증 데이터 │
│ • 대시보드      │ • RAG 검색      │ • 이미지 OCR    │ • 워크플로우 로그    │
│                 │ • 모니터링      │ • 임베딩 생성   │ • 성능 데이터       │
└─────────────────┴─────────────────┴─────────────────┴─────────────────────┘
```

---

## 🔄 **데이터 플로우 아키텍처**

### **1. 문서 처리 파이프라인**

```
📄 PDF 업로드
    ↓
🎯 Supervisor Agent (LangGraph)
    ↓
┌─────────────────────────────────────────────┐
│          Multi-Agent 처리                   │
├─────────────────────────────────────────────┤
│ 📄 PDF 분석 → 📝 텍스트 추출               │
│      ↓               ↓                      │
│ 📊 표 추출 → 🖼️ 이미지 OCR                │
│      ↓               ↓                      │
│ 📝 Markdown 변환 → 🧠 임베딩 생성          │
│      ↓               ↓                      │
│ 🗂️ 벡터 저장 → ✅ 처리 완료               │
└─────────────────────────────────────────────┘
    ↓
💾 PostgreSQL 데이터베이스
```

### **2. 쿼리 처리 플로우**

```
💬 사용자 질의 (자연어)
    ↓
🔍 RAG 검색 엔진
    ↓
🧠 벡터 유사도 검색 (pgvector)
    ↓
📋 관련 문서 청크
    ↓
🤖 GPT-4 답변 생성
    ↓
📝 구조화된 응답
```

### **3. 실시간 모니터링 플로우**

```
🎯 에이전트 실행
    ↓
📊 LangFuse 모니터링
    ↓
💾 워크플로우 로그 (데이터베이스)
    ↓
📈 성능 대시보드
    ↓
🔍 실시간 시각화
```

---

## 🏛️ **레이어 아키텍처**

### **프론트엔드 레이어 (React + TypeScript)**

```
┌─────────────────────────────────────────────┐
│              프론트엔드 컴포넌트             │
├─────────────────────────────────────────────┤
│ 🎨 UI 레이어                               │
│   • ChatInterface.tsx                      │
│   • PolicyManagement.tsx                   │
│   • WorkflowMonitoring.tsx                 │
│   • PerformanceDashboard.tsx               │
│                                             │
│ 🔌 서비스 레이어                           │
│   • api.ts (HTTP 클라이언트)               │
│   • AuthContext.tsx                        │
│                                             │
│ 🛠️ 유틸리티 & 훅                          │
│   • useWebSocket.ts                        │
│   • formatUtils.ts                         │
└─────────────────────────────────────────────┘
```

### **백엔드 레이어 (FastAPI + Python)**

```
┌─────────────────────────────────────────────┐
│               백엔드 서비스                 │
├─────────────────────────────────────────────┤
│ 🚀 API 라우터 레이어                       │
│   • /auth/* - 인증                         │
│   • /policies/* - 약관 관리                │
│   • /search/* - RAG 검색                   │
│   • /workflow/* - 모니터링                 │
│   • /dashboard/* - 성능                    │
│                                             │
│ 🛠️ 서비스 레이어                           │
│   • AuthService (JWT)                      │
│   • DatabaseService (SQLAlchemy)           │
│   • VectorStoreService (pgvector)          │
│   • PerformanceCollector                   │
│                                             │
│ 🤖 에이전트 레이어 (LangGraph)              │
│   • SupervisorAgent                        │
│   • PDFProcessorAgent                      │
│   • TextProcessorAgent                     │
│   • TableProcessorAgent                    │
│   • ImageProcessorAgent                    │
│   • EmbeddingAgent                         │
│   • VectorStoreAgent                       │
└─────────────────────────────────────────────┘
```

### **데이터베이스 레이어 (PostgreSQL + pgvector)**

```
┌─────────────────────────────────────────────┐
│              데이터베이스 스키마             │
├─────────────────────────────────────────────┤
│ 👥 핵심 테이블                             │
│   • users - 사용자 인증                    │
│   • policies - 약관 메타데이터             │
│   • workflow_logs - 에이전트 실행 로그     │
│                                             │
│ 🧠 벡터 테이블                             │
│   • embeddings_text_embedding_3 (3072차원) │
│   • embeddings_qwen (4096차원)             │
│                                             │
│ 🔍 인덱스                                  │
│   • HNSW 벡터 인덱스                       │
│   • IVFFlat 인덱스                         │
│   • B-tree 인덱스                          │
└─────────────────────────────────────────────┘
```

### **외부 서비스**

```
┌─────────────────────────────────────────────┐
│             외부 서비스 연동                │
├─────────────────────────────────────────────┤
│ 🤖 OpenAI API                              │
│   • GPT-4 (채팅 완성)                      │
│   • text-embedding-3-large (임베딩)        │
│                                             │
│ 📊 LangFuse                                │
│   • 워크플로우 모니터링                    │
│   • 성능 추적                              │
│   • 추적 시각화                            │
│                                             │
│ 🔗 MCP 프로토콜                            │
│   • 자동 도구 호출                         │
│   • 컨텍스트 인식 함수                     │
└─────────────────────────────────────────────┘
```

---

## 🔧 **기술 스택**

### **프론트엔드**
- **프레임워크**: React 18 + Next.js 14
- **언어**: TypeScript
- **스타일링**: Tailwind CSS
- **상태 관리**: React Context + useState
- **HTTP 클라이언트**: Axios
- **아이콘**: Lucide React
- **차트**: Recharts

### **백엔드**
- **프레임워크**: FastAPI
- **언어**: Python 3.11+
- **AI 프레임워크**: LangGraph + LangChain
- **ORM**: SQLAlchemy
- **인증**: JWT
- **파일 처리**: PyMuPDF, pdfplumber
- **OCR**: Tesseract, easyOCR
- **모니터링**: LangFuse

### **데이터베이스**
- **주 데이터베이스**: PostgreSQL 15+
- **벡터 확장**: pgvector
- **벡터 차원**: 3072 (OpenAI), 4096 (Qwen)
- **인덱싱**: HNSW, IVFFlat

### **AI & ML**
- **LLM**: OpenAI GPT-4
- **임베딩**: text-embedding-3-large
- **에이전트 프레임워크**: LangGraph
- **벡터 검색**: pgvector + 코사인 유사도

---

## 🚀 **주요 기능**

### **1. Multi-Agent PDF 처리**
- **병렬 처리**: 여러 에이전트가 동시에 작업
- **구조화된 추출**: 텍스트, 표, 이미지를 별도로 처리
- **품질 보증**: 각 단계에서 검증 및 오류 처리
- **확장 가능한 아키텍처**: 새로운 처리 에이전트 추가 용이

### **2. 고급 RAG 검색**
- **하이브리드 검색**: 벡터 + 키워드 검색
- **멀티 모델 임베딩**: 여러 임베딩 모델 지원
- **컨텍스트 인식**: 대화 컨텍스트 유지
- **실시간 결과**: 1초 미만 응답 시간

### **3. 실시간 모니터링**
- **워크플로우 추적**: 모든 에이전트 실행 로그
- **성능 메트릭**: 응답 시간, 성공률
- **시각적 대시보드**: 인터랙티브 차트 및 그래프
- **알림 시스템**: 문제 발생 시 자동 알림

### **4. 확장 가능한 아키텍처**
- **마이크로서비스 설계**: 독립적이고 확장 가능한 컴포넌트
- **비동기 처리**: 비차단 작업
- **캐싱 전략**: 자주 액세스되는 데이터를 위한 Redis
- **로드 밸런싱**: 수평 확장 지원

---

## 📈 **성능 특성**

### **처리 속도**
- **PDF 분석**: 문서당 ~30-60초
- **검색 응답**: 평균 <1초
- **동시 사용자**: 50+ 명의 동시 사용자
- **처리량**: 분당 100+ 쿼리

### **정확도 메트릭**
- **텍스트 추출**: 95%+ 정확도
- **표 인식**: 90%+ 정확도
- **검색 관련성**: 85%+ 사용자 만족도
- **OCR 정확도**: 명확한 이미지에 대해 90%+

### **확장성**
- **데이터베이스**: 최대 1M+ 문서
- **벡터 저장소**: 10M+ 임베딩
- **동시 처리**: 10+ 병렬 워크플로우
- **응답 시간**: 엔드투엔드 <3초

---

## 🔒 **보안 기능**

### **인증 및 권한 부여**
- **JWT 토큰**: 보안 세션 관리
- **역할 기반 액세스**: ADMIN/USER 권한
- **API 보안**: 속도 제한, CORS 보호
- **데이터 암호화**: 저장 및 전송 중 암호화

### **데이터 보호**
- **입력 검증**: SQL 인젝션 방지
- **파일 보안**: 업로드 제한 및 스캔
- **프라이버시**: 로그에 민감한 데이터 없음
- **규정 준수**: GDPR 준비된 데이터 처리

---

## 🛠️ **배포 아키텍처**

### **개발 환경**
```
로컬 개발
├── 프론트엔드 (localhost:3000)
├── 백엔드 (localhost:8000)
├── PostgreSQL (localhost:5432)
└── Redis (localhost:6379)
```

### **프로덕션 환경**
```
프로덕션 배포
├── 로드 밸런서 (nginx)
├── 프론트엔드 컨테이너 (React)
├── 백엔드 컨테이너 (FastAPI)
├── 데이터베이스 클러스터 (PostgreSQL)
├── 벡터 저장소 (pgvector)
├── 모니터링 (LangFuse)
└── 외부 API (OpenAI)
```

---

## 📋 **디렉토리 구조**

```
ispl2/
├── 📊 archi.svg                     # 아키텍처 다이어그램
├── 📊 archi2.svg
├── 🖥️ frontend/                     # React 애플리케이션
│   ├── src/
│   │   ├── components/              # React 컴포넌트
│   │   ├── services/                # API 클라이언트
│   │   ├── utils/                   # 헬퍼 함수
│   │   └── app/                     # Next.js 페이지
│   ├── package.json
│   └── tailwind.config.js
├── 🌐 backend/                      # FastAPI 애플리케이션
│   ├── agents/                      # LangGraph 에이전트
│   ├── routers/                     # API 라우트
│   ├── services/                    # 비즈니스 로직
│   ├── models/                      # 데이터베이스 모델
│   ├── utils/                       # 헬퍼 유틸리티
│   ├── main.py                      # 애플리케이션 진입점
│   └── requirements.txt
├── 🗄️ database/                     # 데이터베이스 설정
│   ├── init.sql                     # 스키마 초기화
│   └── Dockerfile
└── 📋 Insurance Policy_prd.md       # 요구사항 문서
```

---

## 🔮 **향후 개선사항**

### **계획된 기능**
- **다국어 지원**: 한국어, 영어, 중국어
- **고급 분석**: 예측 인사이트
- **API 통합**: 타사 보험 시스템
- **모바일 앱**: iOS/Android 애플리케이션
- **음성 인터페이스**: 음성-텍스트 통합

### **기술적 개선**
- **마이크로서비스**: 완전한 서비스 분해
- **Kubernetes**: 컨테이너 오케스트레이션
- **GraphQL**: 향상된 API 유연성
- **WebRTC**: 실시간 통신
- **엣지 컴퓨팅**: 분산 처리

---

*이 아키텍처 문서는 2024년 9월 현재 ISPL2 시스템의 상태를 나타냅니다. 이 시스템은 미래의 보험 AI 애플리케이션을 지원하기 위해 확장성, 유지보수성, 확장 가능성을 고려하여 설계되었습니다.*
